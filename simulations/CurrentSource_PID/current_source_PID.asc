Version 4
SHEET 1 2148 1512
WIRE 272 -32 272 -48
WIRE 272 80 272 48
WIRE 576 80 576 64
WIRE 48 96 48 48
WIRE 16 112 -48 112
WIRE 96 128 80 128
WIRE 208 128 176 128
WIRE 16 144 0 144
WIRE 48 176 48 160
WIRE 0 256 0 144
WIRE 128 256 0 256
WIRE 272 256 272 176
WIRE 272 256 208 256
WIRE 480 256 272 256
WIRE 656 256 608 256
WIRE 768 256 736 256
WIRE 800 256 768 256
WIRE 912 256 880 256
WIRE 0 272 0 256
WIRE 272 304 272 256
WIRE 0 368 0 352
WIRE 768 416 768 256
WIRE 816 416 768 416
WIRE 912 432 912 256
WIRE 912 432 880 432
WIRE 1104 432 912 432
WIRE -512 448 -640 448
WIRE -368 448 -512 448
WIRE -48 448 -48 112
WIRE -48 448 -288 448
WIRE 48 448 -48 448
WIRE 272 448 272 384
WIRE 272 448 128 448
WIRE 480 448 608 256
WIRE 480 448 272 448
WIRE 608 448 480 256
WIRE 656 448 608 448
WIRE 768 448 736 448
WIRE 816 448 768 448
WIRE 768 480 768 448
WIRE -640 496 -640 448
WIRE 272 512 272 448
WIRE 320 512 272 512
WIRE 768 576 768 560
WIRE -640 608 -640 576
WIRE 272 720 272 512
WIRE 272 832 272 800
WIRE 384 1024 272 1024
WIRE 512 1024 512 1008
WIRE 512 1024 464 1024
WIRE 656 1024 512 1024
WIRE 832 1024 832 1008
WIRE 832 1024 736 1024
WIRE 880 1024 832 1024
WIRE 1056 1024 960 1024
WIRE 272 1056 272 1024
WIRE 512 1056 512 1024
WIRE 832 1056 832 1024
WIRE 1056 1056 1056 1024
WIRE 272 1152 272 1136
WIRE 512 1152 512 1120
WIRE 832 1152 832 1120
WIRE 1056 1152 1056 1136
WIRE 1216 1312 1216 1296
WIRE 1712 1312 1712 1296
WIRE 1216 1408 1216 1392
WIRE 1712 1408 1712 1392
FLAG 272 -48 +24V
FLAG 0 368 0
FLAG 272 832 0
FLAG 576 80 0
FLAG 576 -16 +24V
FLAG -640 608 0
FLAG 48 48 +24V
FLAG 48 176 0
FLAG 848 400 +24V
FLAG 848 464 0
FLAG 768 576 0
FLAG 1104 432 current_measure
IOPIN 1104 432 Out
FLAG 320 512 voltage_measure
IOPIN 320 512 Out
FLAG -512 448 current_setpoint
FLAG 272 1152 0
FLAG 512 1152 0
FLAG 832 1152 0
FLAG 1056 1152 0
FLAG 512 1008 Tj
FLAG 832 1008 Tcase
FLAG 1216 1408 0
FLAG 1216 1296 Rpt100
IOPIN 1216 1296 Out
FLAG 1712 1408 0
FLAG 1712 1296 Tpt100
IOPIN 1712 1296 Out
SYMBOL res 256 -48 R0
SYMATTR InstName R1
SYMATTR Value 47
SYMBOL res 224 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL res 144 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 47k
SYMBOL res -16 256 R0
SYMATTR InstName R4
SYMATTR Value 47k
SYMBOL res -272 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL res 256 288 R0
SYMATTR InstName R7
SYMATTR Value 220
SYMBOL voltage 576 -32 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 24
SYMBOL voltage -640 480 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value 2
SYMBOL pnp 208 176 M180
SYMATTR InstName Q2
SYMATTR Value BC857C
SYMBOL Opamps\\LT1490A 48 64 R0
WINDOW 3 -138 14 Left 2
SYMATTR InstName U1
SYMBOL res 192 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100
SYMBOL Opamps\\LT1490A 848 368 R0
SYMATTR InstName U2
SYMBOL res 752 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 22k
SYMBOL res 752 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 22k
SYMBOL res 896 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res 784 576 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL bv 272 704 R0
SYMATTR InstName B1
SYMATTR Value V=100*(1 + 3.9083e-3*( V(Tj) )  ) *I(B1)
SYMBOL bi2 272 1056 R0
WINDOW 3 -32 135 Left 2
SYMATTR Value I= I(B1) * V(voltage_measure)
SYMATTR InstName B2
SYMBOL cap 496 1056 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL cap 816 1056 R0
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL res 480 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 0.4
SYMBOL voltage 1056 1040 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Tamb}
SYMBOL res 976 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 399
SYMBOL res 752 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 0.5
SYMBOL bv 1216 1296 R0
SYMATTR InstName B3
SYMATTR Value V=V(voltage_measure)/I(B1)
SYMBOL bv 1712 1296 R0
SYMATTR InstName B4
SYMATTR Value V=(V(Rpt100) / 100 -1)/3.9083e-3
TEXT -768 712 Left 2 !;.dc V3 0 3.3 0.1\n.tran 10\n.param R_PT100 100\n.param T=0
TEXT -552 216 Left 2 ;R2 and R4 define current per input voltage
TEXT -760 472 Left 2 ;max. 3.3V
TEXT -384 504 Left 2 ;"protection" resistor
TEXT 936 216 Left 2 ;differential amplifier\nmeasure voltage across R7
TEXT 288 648 Left 2 ;PT100 temperature sensor\nvoltage controlled resistor
TEXT -760 880 Left 2 ;.tran 1\n.save V(voltage_measure) V(current_measure) I(Pt100)\n.step param R_PT100 100 150 10\n.measure Vmeas_avg avg V(voltage_measure)\n.measure Imeas_avg avg V(current_measure)\n.measure Ipt100_avg avg I(Pt100)
TEXT -784 848 Left 3 ;Simulate current vs PT100
TEXT -784 680 Left 3 ;Simulate current vs input voltage
TEXT 216 928 Left 3 ;Thermal Model
TEXT 1200 968 Left 2 !* initial conditions, start all temperatures at ambient\n.param Tamb = {27}\n.ic V(Tcase) = {Tamb}\n.ic V(tj) = {Tamb}
TEXT 1200 1088 Left 2 ;.meas Rpt100 avg V(voltage_measure)/I(B1)\n.meas Tpt100 param (Rpt100 / 100 -1)/3.9083e-3
LINE Normal 576 192 576 608 2
LINE Normal 1376 192 576 192 2
LINE Normal 576 608 1376 608 2
LINE Normal 576 608 576 608 2
LINE Normal -32 240 -32 240 2
LINE Normal 240 208 -32 208 2
LINE Normal 240 384 240 208 2
LINE Normal 240 400 240 384 2
LINE Normal -32 400 240 400 2
LINE Normal -32 208 -32 400 2
LINE Normal -32 208 -32 208 2
